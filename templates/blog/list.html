{% extends './base.html' %}

{% load static %}

{% block main %}
  <div class="main">
    <div class="container list">
      <div class="row">
        <div id="article_list" class="col-md-10 col-md-offset-1">
        </div>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1 text-center">
          <ul id="pagination">
          </ul>
        </div>
      </div>
    </div>

  </div>
{% endblock %}



{% block other_js %}
  <script src="{% static 'bootstrap-paginator/bootstrap-paginator.js' %}"></script>
  <script src="{% static 'js/constants.js' %}"></script>
  <script>
    var get_page_number_url = "{% url 'blog:api:blog-list' %}";
    var get_detail_url = "{% url 'blog:blog_detail' 0 %}";

    $(function () {
      // 设置列表数据
      CALLBACK.getArticlePagination()
    });


    var CALLBACK = {
      getArticlePagination: function () {
        $.get(get_page_number_url, {}, function (data) {
          var currentPage = 1;
          var totalPages = data['pageNumber'];
          var posts = data["posts"];
          CALLBACK.setArticle(CALLBACK.genArticleHtml(posts));
          var options = {
            bootstrapMajorVersion: 3,
            currentPage: currentPage,
            totalPages: totalPages,
            numberofPages: 5,
            itemTexts: function (type, page, current) { //修改显示文字
              switch (type) {
                case "first":
                  return "第一页";
                case "prev":
                  return "上一页";
                case "next":
                  return "下一页";
                case "last":
                  return "最后一页";
                case "page":
                  return page;
              }
            },
            onPageClicked: function (event, originalEvent, type, page) { //异步换页
              $.get(get_page_number_url, {page: page}, function (data) {
                var posts = data["posts"];
                CALLBACK.setArticle(CALLBACK.genArticleHtml(posts));
              });
            }
          };
          $("#pagination").bootstrapPaginator(options);
        });
      },
      genArticleHtml: function (articles) {
        var html = '';
        for (var i = 0; i < articles.length; i++) {
          if (articles[i].image == null) {
            articles[i].image = MYCONST.blogImage
          }
          var url = get_detail_url.replace(0, articles[i].id);

          html += `<div class="media">
            <a class="media-left" href="${url}">
              <img alt="docker-kagnt" src="${articles[i].image}"
                   data-holder-rendered="true" width="229" height="185">
            </a>
            <div class="media-body">
              <h6 class="media-heading">
                <a href="${url}">
                  ${articles[i]["title"]}
                </a>
              </h6>
              <div class="description">
                ${articles[i]['description']}
              </div>
              <div class="extra">
                <a href="#tag/docker">
                  <div class="label"><i class="ion-pricetag"></i>docker</div>
                </a>
                <a href="#tag/linux">
                  <div class="label"><i class="ion-pricetag"></i>linux</div>
                </a>

                <div class="info">
                  <i class="ion-person"></i>${articles[i]['username']}&nbsp;,&nbsp;
                  <i class="ion-clock"></i>${articles[i]['created_time']}&nbsp;
                  <i class="ion-ios-eye"></i>${articles[i]['views']}
                </div>
              </div>
            </div>
          </div>`
        }
        return html
      },
      setArticle: function (html) {
        $("#article_list").html(html)
      }
    }
  </script>
{% endblock %}