{% extends 'base.html' %}
{% load static %}

{% block other_css_js %}
<style>
#pagination ul{
    display: inline-block;
    padding-left: 0;
    margin: 20px 0;
    border-radius: 4px;
}


</style>
{% endblock %}

{% block section_contain %}
    <section class="container pt-20">
        <!--<div class="Huialert Huialert-info"><i class="Hui-iconfont">&#xe6a6;</i>成功状态提示</div>-->
        {% block contain_left %}
            <!--left-->
            <div class="col-sm-9 col-md-9">
                <!--滚动图-->
                <div class="slider_main">
                    <div class="slider">
                        <div class="bd">
                            <ul>
                                <li><a href="#" target="_blank"><img src="{% static 'img/temp/slide2.jpg' %}"></a></li>
                                <li><a href="#" target="_blank"><img src="{% static 'img/temp/banner8.png' %}"></a></li>
                            </ul>
                        </div>
                        <ol class="hd cl dots">
                            <li>1</li>
                            <li>2</li>
                        </ol>
                        <a class="slider-arrow prev" href="javascript:void(0)"></a>
                        <a class="slider-arrow next" href="javascript:void(0)"></a>
                    </div>
                </div>

                <div class="mt-20 bg-fff box-shadow radius mb-5">
                    <div class="tab-category">
                        <a href=""><strong class="current">最新发布</strong></a>
                    </div>
                </div>
                <div class="art_content" id="art_content">
                    <ul class="index_arc">
                    <template v-for="blog_data in blog_datas">
                            <li class="index_arc_item" :class="setclass(blog_data.image)">
                                    <a v-if="blog_data.image" :href="blog_data.detail_url" class="pic">
                                        <img class="lazyload" :src="blog_data.image" alt="应该选"/>
                                    </a>
                                <h4 class="title"><a :href="blog_data.detail_url">[[ blog_data.title ]]</a>
                                </h4>
                                <div class="date_hits">
                                    <span>[[ blog_data.username ]]</span>
                                    <span>[[ blog_data.created_time ]]</span>
                                    <span><a
                                            :href="blog_data.category_name_url">[[ blog_data.category_name ]]</a></span>
                                    <p class="hits"><i class="Hui-iconfont" title="浏览量">&#xe6c1;</i> [[ blog_data.views ]]
                                    </p>
                                    <p class="commonts"><i class="Hui-iconfont" title="评论数">&#xe622;</i> <span
                                            class="cy_cmt_count">20</span></p>
                                </div>
                                <div class="desc">
                                    [[ blog_data.body ]]
                                </div>
                            </li>
                    </template>
                    </ul>
                    <div class="text-c mb-20" id="moreBlog">
                        <ul id="pagination"></ul>
                    </div>
                </div>
            </div>
        {% endblock %}
        {% block contain_right %}
            <!--right-->
            <div class="col-sm-3 col-md-3">

                <!--站点声明-->
                <div class="panel panel-default mb-20">
                    <div class="panel-body">
                        <i class="Hui-iconfont" style="float: left;">&#xe62f;&nbsp;</i>
                        <div class="slideTxtBox">
                            <div class="bd">
                                <ul>
                                    <li><a href="javascript:void(0);">累兰羽测试版上线，欢迎访问</a></li>
                                    <li><a href="javascript:void(0);">内容如有侵犯，请立即联系管理员删除</a></li>
                                    <li><a href="javascript:void(0);">本站内容仅供学习和参阅，不做任何商业用途</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!--博主信息-->
                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>博主信息</strong></a>
                    </div>
                    <div class="tab-category-item">
                        <ul class="index_recd">
                            <li class="index_recd_item"><i class="Hui-iconfont">&#xe653;</i>姓名：累兰羽</li>
                            <li class="index_recd_item"><i class="Hui-iconfont">&#xe70d;</i>职业：python web开发</li>
                            <li class="index_recd_item"><i class="Hui-iconfont">&#xe63b;</i>邮箱：<a
                                    href="mailto:1033432955@qq.com">1033432955@qq.com</a></li>
                            <li class="index_recd_item"><i class="Hui-iconfont">&#xe671;</i>定位：江苏 &middot; 南京</li>
                        </ul>
                    </div>
                </div>


                <!--热门推荐-->
                <div class="bg-fff box-shadow radius mb-20" style="display: none;">
                    <div class="tab-category">
                        <a href=""><strong>热门推荐</strong></a>
                    </div>
                    <div class="tab-category-item">
                        <ul class="index_recd">
                            <li>
                                <a href="#">阻止a标签href默认跳转事件</a>
                                <p class="hits"><i class="Hui-iconfont" title="点击量">&#xe622;</i> 276 </p>
                            </li>

                            <li>
                                <a href="#">PHP面试题汇总</a>
                                <p class="hits"><i class="Hui-iconfont" title="点击量">&#xe622;</i> 276 </p>
                            </li>
                            <li>
                                <a href="#">阻止a标签href默认跳转事件</a>
                                <p class="hits"><i class="Hui-iconfont" title="点击量">&#xe622;</i> 276 </p>
                            </li>
                            <li>
                                <a href="#">阻止a标签href默认跳转事件</a>
                                <p class="hits"><i class="Hui-iconfont" title="点击量">&#xe622;</i> 276 </p>
                            </li>
                            <li>
                                <a href="#">PHP面试题汇总</a>
                                <p class="hits"><i class="Hui-iconfont" title="点击量">&#xe622;</i> 276 </p>
                            </li>
                        </ul>
                    </div>
                </div>

                <!--点击排行-->
                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>点击排行</strong></a>
                    </div>
                    <div class="tab-category-item">
                        <ul class="index_recd clickTop">
                            {% for sort_blog in click_sort_blogs %}
                                <li>
                                    <a href="{% url 'blog:blog_detail' sort_blog.id %}">{{ sort_blog.title }}</a>
                                    <p class="hits"><i class="Hui-iconfont" title="点击量">
                                        &#xe6c1;</i> {{ sort_blog.views }}° </p>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <!--标签-->
                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>标签云</strong></a>
                    </div>
                    <div class="tab-category-item">
                        <div class="tags">
                            {% for tag in tags %}
                            <a href="#">{{ tag.name }}</a>
                            {% endfor %}

                        </div>
                    </div>
                </div>
                <!--图片-->
                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>扫我关注</strong></a>
                    </div>
                    <div class="tab-category-item">
                        <img data-original="{% static 'img/temp/weixin.jpg' %}" class="img-responsive lazyload"
                             alt="响应式图片">
                    </div>
                </div>

                <!--友情链接-->
                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>博客推荐</strong></a>
                    </div>
                    <div class="tab-category-item">
                        {% for friend_link in friend_links %}
                        <span><i class="Hui-iconfont">&#xe6f1;</i><a href="{{ friend_link.url }}" target="_blank" class="btn-link">{{ friend_link.name }}</a></span>
                        {% endfor %}
                    </div>
                </div>
                <!--最近访客-->
                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>最近访客</strong></a>
                    </div>
                    <div class="panel-body">
                        <ul class="recent"></ul>
                    </div>
                </div>

                <!--分享-->
{% comment %}                <div class="bg-fff box-shadow radius mb-20">
                    <div class="tab-category">
                        <a href=""><strong>站点分享</strong></a>
                    </div>
                    <div class="panel-body">
                        <div class="bdsharebuttonbox Hui-share"><a href="#" class="bds_weixin Hui-iconfont"
                                                                   data-cmd="weixin"
                                                                   title="分享到微信">&#xe694;</a><a href="#"
                                                                                                class="bds_qzone Hui-iconfont"
                                                                                                data-cmd="qzone"
                                                                                                title="分享到QQ空间">
                            &#xe6c8;</a> <a
                                href="#" class="bds_sqq Hui-iconfont" data-cmd="sqq" title="分享到QQ好友">&#xe67b;</a> <a
                                href="#"
                                class="bds_tsina Hui-iconfont"
                                data-cmd="tsina"
                                title="分享到新浪微博">
                            &#xe6da;</a> <a href="#" class="bds_tqq Hui-iconfont" data-cmd="tqq" title="分享到腾讯微博">
                            &#xe6d9;</a>
                        </div>
                    </div>
                </div>{% endcomment %}


            </div>
        {% endblock %}

    </section>
{% endblock %}

{% block bottom_js %}
<script>
    var get_page_number_url = "{% url 'blog:api:blog-list' %}";
    var get_record_ip_url = "{% url 'users:api:recordip-list' %}";

    var blogapp = new Vue({
        el: "#art_content",
        delimiters: ['[[', ']]'],
        data:{
            blog_datas:[]
        },
        methods:{
            setclass: function (image) {
                if (image == null){
                    return "no_pic"
                }
            },
        }
    });

    $(function () {
        // 分页
        $.get(get_page_number_url, {}, function (data) {
            var currentPage = 1;
            var totalPages =data['pageNumber'];

            var posts = data["posts"];
            blogapp.blog_datas = [];
            blogapp.blog_datas = blogapp.blog_datas.concat(posts);

            var options = {
                bootstrapMajorVersion: 3,
                currentPage: currentPage,
                totalPages: totalPages,
                numberofPages: 5,
                itemTexts: function (type, page, current) { //修改显示文字
                    switch (type) {
                        case "first":
                            return "第一页";
                        case "prev":
                            return "上一页";
                        case "next":
                            return "下一页";
                        case "last":
                            return "最后一页";
                        case "page":
                            return page;
                    }
                },
                onPageClicked: function (event, originalEvent, type, page) { //异步换页
                    $.get(get_page_number_url, {page: page}, function (data) {
                        var posts = data["posts"];
                        blogapp.blog_datas = [];
                        blogapp.blog_datas = blogapp.blog_datas.concat(posts)
                    });
                }
            };
            $("#pagination").bootstrapPaginator(options);
        });

        // 最近访客

        $.get(get_record_ip_url, {}, function (data) {
            var $recent = $('.recent')
            for (var i=0; i < data.length; i++){
                var last_login_ip = data[i].last_login_ip;
                if (data[i].user_image != null){
                    var image_url = data[i].user_image;
                    last_login_ip = data[i].username;

                }else {
                    var image_url ="http://q.qlogo.cn/qqapp/101388738/1CF8425D24660DB8C3EBB76C03D95F35/40";
                }
                $recent.append("<div>" +
                        "<img src="+image_url+"  height=\"40\" width=\"40\" >" +
                        "<span style=\"margin-left: 10px;\">"+last_login_ip+"</span>" +
                        "</div>")
            }
        })



    })


</script>
{% endblock %}